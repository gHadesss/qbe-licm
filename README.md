# Loop Invariant Code Motion

## Алгоритм

### Выделение естественных циклов
- Обратное ребро - ребро <N, H>, где H = Dom(N).
- Естественный цикл обратного ребра <N, H> - множество базовых блоков X, над которыми доминирует H, из которых можно достичь узла N, не проходя через узел H.

Для нахождения обратных ребер нужно перебрать все ребра ГПУ. Если блок, в который входит рассматриваемая дуга, в дереве доминаторов является предком блока, из которого выходит рассматриваемая дуга, то эта дуга является обратным ребром.

Для получения множества блоков цикла можно воспользоваться следующим алгоритмом:
```
body = {H}
push N onto an empty stack;
while (stack != empty) {
    pop D from the stack;
    if (D not in body) {
        body = {D} union body;
        push each predecessor of D
            onto the stack.
    }
}
```

### Перенос инвариантов
Инвариантом цикла являются:
- константа c;
- переменная u, все определения которой находятся вне цикла;
- переменная v, определяемая внутри цикла, если:
    * если у v есть всего одно определение,
    * это определение находится в базовом блоке, являющемся доминатором всех выходов из цикла,
    * определяющая переменную v инструкция является инвариантной относительно цикла.

Инструкция инвариантна относительно цикла, если все ее операнды являются инвариантами цикла. Все инвариантные инструкции необходимо перенести из блоков в предзаголовок цикла.

## Запуск
```bash
make build
./main
```

## Пример
В qbe/minic находится "пример фронтенда C для QBE". В папке examples находятся примеры кода в промежуточном представлении QBE, а так же код на C, из которого с помощью minic можно сгенерировать QBE IL. Сборка, запуск minic и запуск licm:
```bash
cd qbe/minic && make && cd ../..
qbe/minic/mcc examples/example.c
./main < examples/example.ssa
```
